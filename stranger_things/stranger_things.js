Survey
    .StylesManager
    .applyTheme("modern");

// get JSON data from "create_quiz" Lambda print output
var json = {
    "title": "Stranger Things Quiz (Seasons 1-3)",
    "showProgressBar": "bottom",
    "startSurveyText": "Start Quiz",
    "pages": [
        {
            "questions": [
                {
                    "type": "radiogroup",
                    "name": "q1",
                    "title": "In Season 1, who is the main character that the group is trying to save from the Upside Down?",
                    "choices": [
                        "Mike Wheeler",
                        "Will Byers",
                        "Dustin Henderson",
                        "Lucas Sinclair"
                    ]
                }
            ]
        },
        {
            "questions": [
                {
                    "type": "radiogroup",
                    "name": "q2",
                    "title": "In Season 1, this doctor forced experiments to be conducted on young children, like Eleven.",
                    "choices": [
                        "Dr. Matthew Brewer",
                        "Dr. Mark Banner",
                        "Dr. Martin Brenner",
                        "Dr. Monty Booner"
                    ]
                }
            ]
        },
        {
            "questions": [
                {
                    "type": "radiogroup",
                    "name": "q3",
                    "title": "In Season 1, Nancy and Jonathan work together to figure out what the suspicious \"faceless creature\" in the woods was. They see a wounded animal get stripped away into the bushes while they are investigating. What type of animal was it?",
                    "choices": [
                        "Deer",
                        "Bear",
                        "Fox",
                        "Dog"
                    ]
                }
            ]
        },
        {
            "questions": [
                {
                    "type": "radiogroup",
                    "name": "q4",
                    "title": "In Season 1, which character did NOT go into the Upside Down?",
                    "choices": [
                        "Mike Wheeler",
                        "Jim Hopper",
                        "Nancy Wheeler",
                        "Barb Holland"
                    ]
                }
            ]
        },
        {
            "questions": [
                {
                    "type": "radiogroup",
                    "name": "q5",
                    "title": "In Season 1, we are introduced to Terry Ives who claims to have lost her daughter long ago but authorities say the child died. Her mind is scattered and she is incoherent, but she remembers her daughter's name which is what?",
                    "choices": [
                        "Jean",
                        "Jillian",
                        "Jane",
                        "Janette"
                    ]
                }
            ]
        },
        {
            "questions": [
                {
                    "type": "radiogroup",
                    "name": "q6",
                    "title": "In Season 1, the police call Joyce to inform her that they found her son, Will, dead in the quarry. Police Chief Jim Hopper then breaks into the lab to find Will's fake body filled with what?",
                    "choices": [
                        "cotton",
                        "slugs",
                        "water",
                        "packing peanuts"
                    ]
                }
            ]
        },
        {
            "questions": [
                {
                    "type": "radiogroup",
                    "name": "q7",
                    "title": "In Season 1, Joyce communicates with Will while he's in the Upside Down by painting the alphabet over Christmas lights. She ends up seeing Will in the wall and commands him to hide. She then uses what to break a hole in the wall out of desperation?",
                    "choices": [
                        "hammer",
                        "shovel",
                        "axe",
                        "chainsaw"
                    ]
                }
            ]
        },
        {
            "questions": [
                {
                    "type": "radiogroup",
                    "name": "q8",
                    "title": "What is Hopper's daughter's name?",
                    "choices": [
                        "Alicia",
                        "Sara",
                        "Rebecca",
                        "Katherine"
                    ]
                }
            ]
        },
        {
            "questions": [
                {
                    "type": "radiogroup",
                    "name": "q9",
                    "title": "Jonathon and Will Byers have a selfish dad who likes to bring up his now ex-wife's (Joyce's) flaws. What is his name?",
                    "choices": [
                        "Lonnie",
                        "Jack",
                        "Jeff",
                        "Lenny"
                    ]
                }
            ]
        },
        {
            "questions": [
                {
                    "type": "radiogroup",
                    "name": "q10",
                    "title": "Mike, Dustin, and Lucas all love this science teacher and A/V Club leader.",
                    "choices": [
                        "Mr. Clarke",
                        "Mr. Tibbs",
                        "Mr. Jackson",
                        "Mr. Morove"
                    ]
                }
            ]
        },
        {
            "questions": [
                {
                    "type": "radiogroup",
                    "name": "q11",
                    "title": "At the beginning of Season 2, we are introduced to a girl with the psychic power to make people see things. She helps her gang rob a bank in Pittsburgh. What is the number on her arm?",
                    "choices": [
                        "006",
                        "007",
                        "008",
                        "009"
                    ]
                }
            ]
        },
        {
            "questions": [
                {
                    "type": "radiogroup",
                    "name": "q12",
                    "title": "At the beginning of Season 2, Joyce and Bob Newby start dating. This is a cute relationship because they know each other from where?",
                    "choices": [
                        "Hawkins Elementary School - Go Lil Tigers!",
                        "Hawkins High School - Go Tigers!",
                        "Indiana University - Go Hoosiers!",
                        "University of Iowa - Go Hawks!"
                    ]
                }
            ]
        },
        {
            "questions": [
                {
                    "type": "radiogroup",
                    "name": "q13",
                    "title": "What does Dustin name the strange slimy, animal-looking thing he finds in his trash can?",
                    "choices": [
                        "D'Artagnan",
                        "Dartarian",
                        "D'arcy",
                        "Dart-agon"
                    ]
                }
            ]
        },
        {
            "questions": [
                {
                    "type": "radiogroup",
                    "name": "q14",
                    "title": "Jonathan and Nancy visit Murray to discuss the tape they recorded during their chat with Dr. Owens. After an interesting night together, they all decide to send the tape of Owens' admission to what newspaper?",
                    "choices": [
                        "Hawkins Sun-Times",
                        "Pittsburgh Sun-Times",
                        "Milwaukee Sun-Times",
                        "Chicago Sun-Times"
                    ]
                }
            ]
        },
        {
            "questions": [
                {
                    "type": "radiogroup",
                    "name": "q15",
                    "title": "Bob helps save the day by resetting the breakers in the Lab after the power goes out and the creatures are on the loose. He writes four FOR loops in his process to hack into the security system. What programming language does he write in?",
                    "choices": [
                        "Fortran",
                        "BASIC",
                        "COBOL",
                        "Pascal"
                    ]
                }
            ]
        },
        {
            "questions": [
                {
                    "type": "radiogroup",
                    "name": "q16",
                    "title": "At the end of Season 2, Billy and Steve get into a fight. Who ends up sedating Billy to keep him from potentially killing Steve?",
                    "choices": [
                        "Max",
                        "Mike",
                        "Nancy",
                        "Jonathan"
                    ]
                }
            ]
        },
        {
            "questions": [
                {
                    "type": "radiogroup",
                    "name": "q17",
                    "title": "At the end of Season 2, Dr. Owens creates a birth certifate for Eleven with what name?",
                    "choices": [
                        "Jane Byers",
                        "Jill Byers",
                        "Jane Hopper",
                        "Jill Hopper"
                    ]
                }
            ]
        },
        {
            "questions": [
                {
                    "type": "radiogroup",
                    "name": "q18",
                    "title": "During the Winter Dance at the end of Season 2, who does Dustin dance with?",
                    "choices": [
                        "Max",
                        "Eleven",
                        "Nancy",
                        "Suzie"
                    ]
                }
            ]
        },
        {
            "questions": [
                {
                    "type": "radiogroup",
                    "name": "q19",
                    "title": "In Season 2, who says \"Let's burn that lab to the ground\"?",
                    "choices": [
                        "Jonathan",
                        "Joyce",
                        "Hopper",
                        "Nancy"
                    ]
                }
            ]
        },
        {
            "questions": [
                {
                    "type": "radiogroup",
                    "name": "q20",
                    "title": "In Season 2, who says \"You act like you want me to be your friend and then you treat me like garbage\"?",
                    "choices": [
                        "Eleven",
                        "Max",
                        "Lucas",
                        "Jonathan"
                    ]
                }
            ]
        },
        {
            "questions": [
                {
                    "type": "radiogroup",
                    "name": "q21",
                    "title": "In Season 2, who says \"I never gave up on you. I called you every night\"?",
                    "choices": [
                        "Mike",
                        "Nancy",
                        "Jonathan",
                        "Lucas"
                    ]
                }
            ]
        },
        {
            "questions": [
                {
                    "type": "radiogroup",
                    "name": "q22",
                    "title": "In Season 3, Dustin creates a makeshift radio tower to communicate with his new summer camp girlfriend named what?",
                    "choices": [
                        "Pansy",
                        "Suzie",
                        "Patty",
                        "Sally"
                    ]
                }
            ]
        },
        {
            "questions": [
                {
                    "type": "radiogroup",
                    "name": "q23",
                    "title": "In Season 3, where do Jonathan and Nancy work as interns?",
                    "choices": [
                        "Hawkins Gazette",
                        "Hawkins Sun",
                        "Hawkins Daily",
                        "Hawkins Post"
                    ]
                }
            ]
        },
        {
            "questions": [
                {
                    "type": "radiogroup",
                    "name": "q24",
                    "title": "What is the name of the Starcourt mall ice cream shop that Steve and Robin work at?",
                    "choices": [
                        "Mall Creamery",
                        "Pirate's Booty",
                        "Scoops Ahoy",
                        "Scurvy Scoops"
                    ]
                }
            ]
        },
        {
            "questions": [
                {
                    "type": "radiogroup",
                    "name": "q25",
                    "title": "Dustin gets his summer camp girlfriend to tell him Planck's Constant which allowed Joyce and Hopper to unlock the vault. She would only give Dustin the value if he sang what song with her?",
                    "choices": [
                        "Dancing Queen",
                        "The NeverEnding Story",
                        "I'll Be There",
                        "You're The One That I Want"
                    ]
                }
            ]
        },
        {
            "questions": [
                {
                    "type": "radiogroup",
                    "name": "q26",
                    "title": "To Steve's surprise, who does Robin have a crush on throughout Season 3?",
                    "choices": [
                        "Nancy Wheeler",
                        "Tabitha Thomas",
                        "Patty Redding",
                        "Tammy Thompson"
                    ]
                }
            ]
        },
        {
            "questions": [
                {
                    "type": "radiogroup",
                    "name": "q27",
                    "title": "While Jonathan and Nancy are investigating Mrs. Driscoll's home, what animal explodes in a cage?",
                    "choices": [
                        "Rat",
                        "Cat",
                        "Rabbit",
                        "Squirrel"
                    ]
                }
            ]
        },
        {
            "questions": [
                {
                    "type": "radiogroup",
                    "name": "q28",
                    "title": "In Season 3, who says \"How many children are you friends with?\"",
                    "choices": [
                        "Steve",
                        "Joyce",
                        "Jonathan",
                        "Robin"
                    ]
                }
            ]
        },
        {
            "questions": [
                {
                    "type": "radiogroup",
                    "name": "q29",
                    "title": "In Season 3, who says \"Now that you're out of high school, which means you're technically an adult, don't you think it's time you moved on from primitive constructs such as popularity?\"",
                    "choices": [
                        "Mike",
                        "Lucas",
                        "Dustin",
                        "Max"
                    ]
                }
            ]
        },
        {
            "questions": [
                {
                    "type": "radiogroup",
                    "name": "q30",
                    "title": "In Season 3, who says \"I may be bald, but you're the one in handcuffs, Soviet scum\" (in Russian)",
                    "choices": [
                        "Alexei",
                        "Murray",
                        "Bob",
                        "Hopper"
                    ]
                }
            ]
        },
        {
            "questions": [
                {
                    "name": "name",
                    "type": "text",
                    "title": "Please enter your nickname:",
                    "placeHolder": "Insert Nickname Here...",
                    "isRequired": "true"
                }
            ]
        }
    ],
    "showQuestionNumbers": "on",
    "completedHtml": "<h4 id=\"result\">Your Score is Loading....</h4>"
};

window.survey = new Survey.Model(json);

survey
    .onComplete
    .add(function (result) {
        post_data = {"quiz_name": "Stranger-Things-Quiz", "data": result.data}
        // console.log('result', JSON.stringify(post_data));
        let endpoint = "https://3ed94zmyfc.execute-api.us-east-1.amazonaws.com/score_quiz";
        $.ajax({
            url: endpoint,
            type: "POST",
            contentType: "application/json",
            dataType: "json",
            data: JSON.stringify(post_data),
            success: function(data){
                // console.log(`POST complete!!! ${JSON.stringify(data)}`);
                let score = data["score"];
                document
                    .querySelector('#result')
                    .textContent = score;
                CreateTableFromJSON(data["leaderboard"], "Leaderboard", "leaderboardTable");
                CreateTableFromJSON(data["questions"], "Quiz Results", "quizResultTable");
            }
        });
    });

$("#surveyElement").Survey({model: survey});

// Create Results Table
function CreateTableFromJSON(json_obj, title, element_id) {
    // extract values for HTML headers
    var col = [];
    for (var i = 0; i < json_obj.length; i++) {
        for (var key in json_obj[i]) {
            if (col.indexOf(key) === -1) {
                col.push(key);
            }
        }
    }

    // create dynamic table
    var table = document.createElement("table");

    // add table caption (title)
    var caption = document.createElement("caption")
    caption.innerHTML = title
    table.appendChild(caption)

    // create HTML table header row
    var tr = table.insertRow(-1);
    for (var i = 0; i < col.length; i++) {
        var th = document.createElement("th"); // add table header to row
        th.innerHTML = col[i];
        tr.appendChild(th);
    }

    // add each JSON question block data to table rows
    for (var i = 0; i < json_obj.length; i++) {
        tr = table.insertRow(-1);
        // add column for each key in JSON question block
        for (var j = 0; j < col.length; j++) {
            var tabCell = tr.insertCell(-1);
            tabCell.innerHTML = json_obj[i][col[j]];
        }
    }

    // add table to quizResultTable div
    var divContainer = document.getElementById(element_id);
    divContainer.innerHTML = "";
    divContainer.appendChild(table);
}

/* When the user clicks on the button, 
toggle between hiding and showing the dropdown content */
function quizDropdown() {
    document.getElementById("myDropdown").classList.toggle("show");
}
  
// Close the dropdown if the user clicks outside of it
window.onclick = function(e) {
    if (!e.target.matches('.dropbtn')) {
        var myDropdown = document.getElementById("myDropdown");
        if (myDropdown.classList.contains('show')) {
            myDropdown.classList.remove('show');
        }
    }
}